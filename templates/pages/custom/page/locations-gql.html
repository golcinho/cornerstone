---
gql: "query {
    inventory {
        locations {
            edges {
                node {
                    entityId
                    code
                    description
                    label
                    typeId
                    address {
                        code
                        address1
                        city
                        stateOrProvince
                        countryCode
                        phone
                        email
                        latitude
                        longitude
                    }
                    operatingHours {
                        sunday {
                            open
                            opening
                            closing
                        }
                        monday {
                            open
                            opening
                            closing
                        }
                        thursday {
                            open
                            opening
                            closing
                        }
                        wednesday {
                            open
                            opening
                            closing
                        }
                        tuesday {
                            open
                            opening
                            closing
                        }
                        friday {
                            open
                            opening
                            closing
                        }
                        saturday {
                            open
                            opening
                            closing
                        }
                    }
                }
            }
        }
    }
}"
---
{{#partial "page"}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}

<section class="page">
    {{#unless theme_settings.hide_page_heading }}
    <h1 class="page-heading">{{ page.title }}</h1>
    {{/unless}}

    {{#if page.sub_pages}}
    <nav class="navBar navBar--sub">
        <ul class="navBar-section account-navigation">
            {{#each page.sub_pages}}
            <li class="navBar-item"><a class="navBar-action" href="{{url}}">{{title}}</a></li>
            {{/each}}
        </ul>
    </nav>
    {{/if}}

    {{{region name="page_builder_content"}}}

    <div class="location">
        <div class="location-list">
            {{#each gql.data.inventory.locations.edges}}
            <div class="location-item" data-location-id="{{node.entityId}}">
                <p class="location-item__title">{{node.label}}</p>
                <p class="location-item__description">{{node.description}}</p>
                -
                <p class="location-item__address">
                    <strong>{{node.address.address1}}</strong>
                    {{node.address.city}}, {{node.address.stateOrProvince}}, {{node.address.countryCode}}
                </p>
            </div>
            {{/each}}
        </div>
        <div class="location-map">
            <div id="details" class="location-item__details">
                <p id="title" class="location-item__title"></p>
                <p id="description"></p>
                <p class="location-item__info">
                    <strong>Address:</strong>
                    <span id="address"></span>
                </p>
                <p class="location-item__info">
                    <strong>Phone:</strong>
                    <span id="phone"></span>
                </p>
                <p class="location-item__info">
                    <strong>Email:</strong>
                    <span id="email"></span>
                </p>
                <p class="location-item__sub-title">Operation hours:</p>
                <table>
                    <thead>
                    <tr>
                        <th>Day</th>
                        <th>Is Open</th>
                        <th>Opening time</th>
                        <th>Closing time</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td id="day-1"></td>
                        <td id="is-open-1"></td>
                        <td id="opening-1"></td>
                        <td id="closing-1"></td>
                    </tr>
                    <tr>
                        <td id="day-2"></td>
                        <td id="is-open-2"></td>
                        <td id="opening-2"></td>
                        <td id="closing-2"></td>
                    </tr>
                    <tr>
                        <td id="day-3"></td>
                        <td id="is-open-3"></td>
                        <td id="opening-3"></td>
                        <td id="closing-3"></td>
                    </tr>
                    <tr>
                        <td id="day-4"></td>
                        <td id="is-open-4"></td>
                        <td id="opening-4"></td>
                        <td id="closing-4"></td>
                    </tr>
                    <tr>
                        <td id="day-5"></td>
                        <td id="is-open-5"></td>
                        <td id="opening-5"></td>
                        <td id="closing-5"></td>
                    </tr>
                    <tr>
                        <td id="day-6"></td>
                        <td id="is-open-6"></td>
                        <td id="opening-6"></td>
                        <td id="closing-6"></td>
                    </tr>
                    <tr>
                        <td id="day-7"></td>
                        <td id="is-open-7"></td>
                        <td id="opening-7"></td>
                        <td id="closing-7"></td>
                    </tr>
                    </tbody>
                </table>
                <button id="close" class="button button--primary">Close</button>
            </div>
            <div id="map"></div>
        </div>
    </div>

    {{#if page.feed}}
    <ul>
        {{#each page.feed}}
        <li>
            <h6><a href="{{url}}" target="_blank">{{title}}</a></h6>
            <p>{{content}}</p>
        </li>
        {{/each}}
    </ul>
    {{/if}}
</section>

{{/partial}}

{{> layout/base}}

<script
        src="https://maps.googleapis.com/maps/api/js?key={KEY}&callback=initMap&libraries=&v=weekly"
        async
></script>

{{inject "locations" gql.data.inventory.locations.edges}}

<script>
    const jsContext = JSON.parse({{jsContext}});
    const locations = jsContext.locations || [];

    function initMap() {
        const myLatLng = { lat: -25.363, lng: 131.044 };
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 4,
            center: myLatLng,
            styles: [
                {
                    "featureType": "water",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#e9e9e9"
                        },
                        {
                            "lightness": 17
                        }
                    ]
                },
                {
                    "featureType": "landscape",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#f5f5f5"
                        },
                        {
                            "lightness": 20
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "geometry.fill",
                    "stylers": [
                        {
                            "color": "#ffffff"
                        },
                        {
                            "lightness": 17
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "elementType": "geometry.stroke",
                    "stylers": [
                        {
                            "color": "#ffffff"
                        },
                        {
                            "lightness": 29
                        },
                        {
                            "weight": 0.2
                        }
                    ]
                },
                {
                    "featureType": "road.arterial",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#ffffff"
                        },
                        {
                            "lightness": 18
                        }
                    ]
                },
                {
                    "featureType": "road.local",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#ffffff"
                        },
                        {
                            "lightness": 16
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#f5f5f5"
                        },
                        {
                            "lightness": 21
                        }
                    ]
                },
                {
                    "featureType": "poi.park",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#dedede"
                        },
                        {
                            "lightness": 21
                        }
                    ]
                },
                {
                    "elementType": "labels.text.stroke",
                    "stylers": [
                        {
                            "visibility": "on"
                        },
                        {
                            "color": "#ffffff"
                        },
                        {
                            "lightness": 16
                        }
                    ]
                },
                {
                    "elementType": "labels.text.fill",
                    "stylers": [
                        {
                            "saturation": 36
                        },
                        {
                            "color": "#333333"
                        },
                        {
                            "lightness": 40
                        }
                    ]
                },
                {
                    "elementType": "labels.icon",
                    "stylers": [
                        {
                            "visibility": "off"
                        }
                    ]
                },
                {
                    "featureType": "transit",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#f2f2f2"
                        },
                        {
                            "lightness": 19
                        }
                    ]
                },
                {
                    "featureType": "administrative",
                    "elementType": "geometry.fill",
                    "stylers": [
                        {
                            "color": "#fefefe"
                        },
                        {
                            "lightness": 20
                        }
                    ]
                },
                {
                    "featureType": "administrative",
                    "elementType": "geometry.stroke",
                    "stylers": [
                        {
                            "color": "#fefefe"
                        },
                        {
                            "lightness": 17
                        },
                        {
                            "weight": 1.2
                        }
                    ]
                }
            ],
        });

        locations.forEach(({ node }) => {
            const { address, label } = node;
            const { latitude, longitude } = address;

            if (latitude !== null && longitude !== null) {
                new google.maps.Marker({
                    position: { lat: parseFloat(latitude.toFixed(3)), lng: parseFloat(longitude.toFixed(3)) },
                    map,
                    title: label,
                });
            }
        });
    }

    const items = document.querySelectorAll('[data-location-id]');

    const handleClick = id => event => {
        event.preventDefault();

        const currentLocations = locations.find(location => location.node.entityId === Number(id));

        if (currentLocations !== undefined) {
            document.getElementById('title').innerText = currentLocations.node.label;
            document.getElementById('description').innerText = currentLocations.node.description;

            document.getElementById('address').innerText = `${currentLocations.node.address.city}, ${currentLocations.node.address.stateOrProvince}, ${currentLocations.node.address.countryCode}. ${currentLocations.node.address.address1}`;
            document.getElementById('phone').innerText = currentLocations.node.address.phone;
            document.getElementById('email').innerText = currentLocations.node.address.email;

            Object.entries(currentLocations.node.operatingHours).forEach(([day, { closing, opening, open }], index) => {
                document.getElementById(`day-${index + 1}`).innerText = day;
                document.getElementById(`is-open-${index + 1}`).innerText = open ? 'Open' : 'Close';
                document.getElementById(`opening-${index + 1}`).innerText = open ? opening : '-';
                document.getElementById(`closing-${index + 1}`).innerText = open ? closing : '-';
            });

            document.getElementById('details').classList.add('is-open');
        }
    };

    const handleCloseClick = event => {
        event.preventDefault();

        document.getElementById('details').classList.remove('is-open');
    };

    document.getElementById('close').addEventListener('click', handleCloseClick)

    items.forEach(item => {
        item.addEventListener('click', handleClick(item.getAttribute('data-location-id')));
    })
</script>
